<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blockchain Explorer</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body class="bg-dark text-light">
    <div class="container mt-4">
        <h2 class="text-center mb-4">üöÄ Blockchain Explorer</h2>

        <!-- Hi·ªÉn th·ªã Blockchain -->
        <button class="btn btn-primary mb-3" onclick="fetchBlockchain()">üîç Xem Chu·ªói Blockchain</button>
        <div id="blockchainData" class="table-responsive"></div>

        <!-- Th√™m Giao D·ªãch -->
        <div class="card bg-secondary p-3 mb-3">
            <h4>üí∞ Th√™m Giao D·ªãch M·ªõi</h4>
            <input class="form-control mb-2" type="text" id="senderKey" placeholder="üîë Kh√≥a c√¥ng khai ng∆∞·ªùi g·ª≠i">
            <input class="form-control mb-2" type="text" id="recipientKey" placeholder="üîë Kh√≥a c√¥ng khai ng∆∞·ªùi nh·∫≠n">
            <input class="form-control mb-2" type="number" id="amount" placeholder="üíµ S·ªë ti·ªÅn">
            <input class="form-control mb-2" type="text" id="signature" placeholder="‚úçÔ∏è Ch·ªØ k√Ω s·ªë">
            <button class="btn btn-success" onclick="addTransaction()">‚úÖ G·ª≠i Giao D·ªãch</button>
        </div>

        <!-- ƒê√†o Block -->
        <button class="btn btn-warning mb-3" id="mineBlockBtn" onclick="mineBlock()">‚õèÔ∏è ƒê√†o Block</button>

        <!-- Ki·ªÉm tra Blockchain h·ª£p l·ªá -->
        <button class="btn btn-info mb-3" onclick="validateBlockchain()">‚úÖ Ki·ªÉm Tra T√≠nh H·ª£p L·ªá</button>
        <p id="validationResult" class="mt-2"></p>
    </div>

    <script>
        function fetchBlockchain() {
            $.get("http://localhost:5000/get_chain", function(data) {
                let html = `<table class="table table-bordered table-dark">
                                <tr>
                                    <th>#</th>
                                    <th>Hash</th>
                                    <th>Giao D·ªãch</th>
                                    <th>Nonce</th>
                                    <th>Timestamp</th>
                                </tr>`;
                data.forEach(block => {
                    html += `<tr>
                                <td>${block.index}</td>
                                <td>${block.hash.substring(0, 15)}...</td>
                                <td>${block.transactions.length} giao d·ªãch</td>
                                <td>${block.nonce}</td>
                                <td>${new Date(block.timestamp).toLocaleString()}</td>
                             </tr>`;
                });
                html += `</table>`;
                $("#blockchainData").html(html);
            });
        }

        function addTransaction() {
            let senderPublicKey = $("#senderKey").val();
            let recipientPublicKey = $("#recipientKey").val();
            let amount = $("#amount").val();
            let signature = $("#signature").val();

            $.ajax({
                url: "http://localhost:5000/add_transaction",
                type: "POST",
                contentType: "application/json",
                data: JSON.stringify({ senderPublicKey, recipientPublicKey, amount, signature }),
                success: function(response) {
                    alert(response.message);
                    fetchBlockchain();
                },
                error: function(error) {
                    alert(error.responseJSON.message);
                }
            });
        }

        function mineBlock() {
            $("#mineBlockBtn").prop("disabled", true).text("‚õèÔ∏è ƒêang ƒë√†o...");
            $.get("http://localhost:5000/mine_block", function(response) {
                alert(response.message);
                fetchBlockchain();
                $("#mineBlockBtn").prop("disabled", false).text("‚õèÔ∏è ƒê√†o Block");
            });
        }

        function validateBlockchain() {
            $.get("http://localhost:5000/validate_chain", function(response) {
                $("#validationResult").text(response.valid ? "‚úÖ Blockchain h·ª£p l·ªá" : "‚ùå Blockchain b·ªã l·ªói!");
            });
        }
    </script>
</body>
</html>
